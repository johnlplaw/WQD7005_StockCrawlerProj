*------------------------------------------------------------*
User:                QR
Date:                May 11, 2019
Time:                21:41:59
Site:                12601940
Platform:            W32_7PRO
Maintenance Release: 9.04.01M3P062415
EM Version:          14.1
* 
*------------------------------------------------------------*
* Training Log
Date:                May 11, 2019
Time:                21:41:55
*------------------------------------------------------------*
14715  proc freq data=EMWS2.GrfExpl_VariableSet noprint;
14716  table ROLE*LEVEL/out=WORK.GrfExplMETA;
14717  run;
 
NOTE: There were 6 observations read from the data set EMWS2.GRFEXPL_VARIABLESET.
NOTE: The data set WORK.GRFEXPLMETA has 2 observations and 4 variables.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.02 seconds
      cpu time            0.03 seconds
 
 
14718  proc print data=WORK.GrfExplMETA label noobs;
14719  var ROLE LEVEL COUNT;
14720  label ROLE = "%sysfunc(sasmsg(sashelp.dmine, meta_role_vlabel, NOQUOTE))" LEVEL = "%sysfunc(sasmsg(sashelp.dmine, meta_level_vlabel, NOQUOTE))" COUNT = "%sysfunc(sasmsg(sashelp.dmine, rpt_count_vlabel, NOQUOTE))";
14721  title9 ' ';
14722  title10 "%sysfunc(sasmsg(sashelp.dmine, rpt_varSummary_title  , NOQUOTE))";
14723  run;
 
NOTE: There were 2 observations read from the data set WORK.GRFEXPLMETA.
NOTE: The PROCEDURE PRINT printed page 1.
NOTE: PROCEDURE PRINT used (Total process time):
      real time           0.02 seconds
      cpu time            0.03 seconds
 
 
14724  title10;
 
14725  %let EMEXCEPTIONSTRING=;
PERFORMANCE  DETAILS
15033  *------------------------------------------------------------*;
15034  * GrfExpl: Generation of macros and macro variables;
15035  * To see the code generated, set the EM_DEBUG macro variable to SOURCE or _ALL_;
15036  *------------------------------------------------------------*;
 
15037  %let EMEXCEPTIONSTRING=;
15038  *------------------------------------------------------------*;
15039  * TRAIN: GrfExpl;
15040  *------------------------------------------------------------*;
15041  %let EM_ACTION = TRAIN;
15042  %let syscc = 0;
15043  %macro main;
15044     filename temp catalog 'sashelp.emexpl.graphexplore_macros.source';
15045     %include temp;
15046     filename temp;
15047
15048     %SetProperties;
15049
15050     %if %upcase(&EM_ACTION) = CREATE %then %do;
15051
15052         filename temp catalog 'sashelp.emexpl.graphexplore_create.source';
15053         %include temp;
15054         filename temp;
15055         %create;
15056     %end;
15057     %else
15058     %if %upcase(&EM_ACTION) = TRAIN %then %do;
15059
15060         filename temp catalog 'sashelp.emexpl.graphexplore_train.source';
15061         %include temp;
15062         filename temp;
15063         %train;
15064
15065     %end;
15066     %else
15067     %if %upcase(&EM_ACTION) = REPORT %then %do;
15068
15069         filename temp catalog 'sashelp.emexpl.graphexplore_report.source';
15070         %include temp;
15071         filename temp;
15072
15073         %report;
15074     %end;
15075
15076  %mend main;
15077
15078  %main;
NOTE: %INCLUDE (level 1) file TEMP is file SASHELP.EMEXPL.GRAPHEXPLORE_MACROS.SOURCE.
15079 +%macro SetProperties;
15080 +   %em_checkmacro(name=EM_PROPERTY_INTERVALBYTARGET,      global=Y, value=Y);
15081 +   %em_checkmacro(name=EM_PROPERTY_CLASSBYTARGET,         global=Y, value=Y);
15082 +   %em_checkmacro(name=EM_PROPERTY_DATASOURCE,            global=Y, value=SAMPLE);
15083 +   %em_checkmacro(name=EM_PROPERTY_EMSAMPLEMETHOD,        global=Y, value=FIRSTN);
15084 +   %em_checkmacro(name=EM_PROPERTY_EMSAMPLESIZE,          global=Y, value=DEFAULT);
15085 +   %em_checkmacro(name=EM_PROPERTY_EMRANDOMSEED,          global=Y, value=12345);
15086 +
15087 +%mend SetProperties;
NOTE: %INCLUDE (level 1) ending.
NOTE: Fileref TEMP has been deassigned.
NOTE: %INCLUDE (level 1) file TEMP is file SASHELP.EMEXPL.GRAPHEXPLORE_TRAIN.SOURCE.
15088 +%macro train;
15089 +
15090 +    %let graphData = &em_import_data;
15091 +    %if "&graphData" eq "" %then
15092 +        %let graphData = &em_import_transaction;
15093 +    %if "&graphData" eq "" %then
15094 +        %let graphData = &em_import_document;
15095 +    %if "&graphData" eq "" %then
15096 +        %let graphData = &em_import_validate;
15097 +    %if "&graphData" eq "" %then
15098 +        %let graphData = &em_import_test;
15099 +    %if "&graphData" eq "" %then
15100 +        %let graphData = &em_import_score;
15101 +
15102 +    %if "&graphData" eq "" %then %do;
15103 +        %let emexceptionString = exception.server.IMPORT.NODATA;
15104 +        %goto doendm;
15105 +    %end;
15106 +
15107 +    %em_getname(key=SAMPLE_DATA, type=DATA);
15108 +
15109 +    filename vartemp catalog 'sashelp.emutil.em_varmacro.source';
15110 +    %include vartemp;
15111 +    filename vartemp;
15112 +
15113 +    data tempVariableSet;
15114 +       set &em_data_variableset;
15115 +       where (ROLE = 'REJECTED' and USE='Y') or ROLE='FREQ' or ( ROLE ne 'REJECTED' and USE in('Y', 'D'));
15116 +       if _N_< 950 or (ROLE = 'TARGET' and USE in('Y', 'D')) or ROLE='FREQ' then output;
15117 +    run;
15118 +    %em_varMacro(name=varSample, metadata=tempVariableSet, where=, key=NAME, nummacro=numVarSample);
15119 +
15120 +
15121 +     %exploreSample(DATA=&graphData, OUTPUT=&EM_USER_SAMPLE_DATA, METADATA=&EM_DATA_VARIABLESET, VARS=%varSample,
15122 +                      METHOD=&EM_PROPERTY_EMSAMPLEMETHOD, SIZE=&EM_PROPERTY_EMSAMPLESIZE,
15123 +                      ALPHA=, PVALUE=, SEED=&EM_PROPERTY_EMRANDOMSEED);
15124 +
15125 +    %doendm:
15126 +
15127 +%mend train;
15128 +
15129 +%train;
NOTE: %INCLUDE (level 2) file VARTEMP is file SASHELP.EMUTIL.EM_VARMACRO.SOURCE.
15131 +%macro em_varMacro(name=emMacro, metadata=, where=, key=NAME, nummacro=, maxvar=-1);
15133 +   filename macFile catalog 'work.emutil.macro.source';
15134 +   %let _METAOBS = 0;
15135 +   %let _maxvar = &maxvar;
15136 +   %if "&_maxvar" eq "" %then %let maxvar = -1;
15138 +   %if (%sysfunc(exist(&metadata))<1 and %sysfunc(exist(&metadata, VIEW))<1)
15139 +                   or (&metadata eq ) %then %do;
15140 +       %put * No metadata data set defined;
15141 +       %goto doend;
15142 +   %end;
15144 +   data _null_;
15145 +      length _STRING_ $80;
15146 +      retain _STRING_ '' maxvar 0;
15147 +      set &metadata end=eof;
15148 +      file macFile;
15149 +      %if %nrbquote(&where) ne %then %do;
15150 +          %let whereClause = where (%nrbquote(&where));
15151 +          %unquote(&whereClause);
15152 +      %end;
15153 +      if _N_=1 then do;
15154 +         string = "%"!!"macro &name;";
15155 +         put string;
15156 +      end;
15157 +      maxvar +1;
15158 +      if (length(_STRING_) + length(trim(&key))+ 4 < 80) then do;
15159 +         _STRING_ = trim(_STRING_)!!' '!!trim(&key);
15160 +         if eof
15161 +            %if  %sysevalf(&_maxvar > 0) %then %do;
15162 +                or maxvar >= &maxvar
15163 +            %end;
15164 +            then do;
15165 +            put _STRING_;
15166 +            string = "%"!!"mend &name;";
15167 +            put string;
15168 +            string = strip(put(_N_, best.));
15169 +            call symput('_METAOBS', string);
15170 +            %if (&nummacro ne ) %then %do;
15171 +                put "%" "global &nummacro;";
15172 +                put "%" "let &nummacro = " string ";";
15173 +            %end;
15174 +            stop;
15175 +         end;
15176 +      end;
15177 +      else do;
15178 +         put _STRING_;
15179 +         _string_ = TRIM(&key);
15180 +         if eof
15181 +            %if  %sysevalf(&_maxvar > 0) %then %do;
15182 +              or maxvar >= &maxvar
15183 +           %end;
15184 +            then do;
15185 +            put _STRING_;
15186 +            string = "%"!!"mend &name;";
15187 +            put string;
15188 +        end;
15189 +      end;
15190 +      if eof
15191 +         %if  %sysevalf(&_maxvar > 0) %then %do;
15192 +             or maxvar >= &maxvar
15193 +         %end;
15194 +         then do;
15195 +         string = strip(put(_N_, best.));
15196 +         call symput('_METAOBS', string);
15197 +         %if (&nummacro ne ) %then %do;
15198 +             put "%" "global &nummacro;";
15199 +             put "%" "let &nummacro = " string ";";
15200 +         %end;
15201 +         stop;
15202 +      end;
15203 +   run;
15205 +   %doend:
15206 +   %if ^&_METAOBS %then %do;
15207 +       data _null_;
15208 +          file macFile;
15209 +          put "%" "macro &name;";
15210 +          put "%" "mend &name;";
15211 +          %if (&nummacro ne ) %then %do;
15212 +              put "%" "global &nummacro;";
15213 +              put "%" "let &nummacro = 0;";
15214 +          %end;
15215 +      run;
15216 +   %end;
15217 +   %inc macFile;
15218 +   filename macFile;
15219 +%mend em_varMacro;
NOTE: %INCLUDE (level 2) ending.
NOTE: %INCLUDE (level 1) resuming.
NOTE: Fileref VARTEMP has been deassigned.
 
NOTE: There were 6 observations read from the data set EMWS2.GRFEXPL_VARIABLESET.
      WHERE ((ROLE='REJECTED') and (USE='Y')) or (ROLE='FREQ') or ((ROLE not = 'REJECTED') and USE in ('D', 'Y'));
NOTE: The data set WORK.TEMPVARIABLESET has 6 observations and 22 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: The file MACFILE is:
      Catalog Name=WORK.EMUTIL.MACRO.SOURCE,
      Catalog Page Size=4096,
      Number of Catalog Pages=4,
      Created=Sat, May 11, 2019 09:41:56 PM,
      Last Modified=Sat, May 11, 2019 09:41:56 PM,
      Filename=C:\Users\QR\AppData\Local\Temp\SAS Temporary Files\_TD37900_JOHNLAW-PC_\emutil.sas7bcat,
      Release Created=9.0401M3,Host Created=W32_7PRO
 
NOTE: 5 records were written to the file MACFILE.
      The minimum record length was 16.
      The maximum record length was 49.
NOTE: There were 6 observations read from the data set WORK.TEMPVARIABLESET.
NOTE: DATA statement used (Total process time):
      real time           0.10 seconds
      cpu time            0.03 seconds
 
 
NOTE: %INCLUDE (level 2) file MACFILE is file WORK.EMUTIL.MACRO.SOURCE.
15220 +%macro varSample;
15221 +GASMSIA PETGAS PETGAS_CR PETGAS_CS SIGGAS thedate
15222 +%mend varSample;
15223 +%global numVarSample;
15224 +%let numVarSample = 6 ;
NOTE: %INCLUDE (level 2) ending.
NOTE: %INCLUDE (level 1) resuming.
NOTE: Fileref MACFILE has been deassigned.
NOTE: %INCLUDE (level 2) file X is file SASHELP.EMUTIL.EXPLOREOBS.SOURCE.
15225 +/*------------------------------------------------------------------
15226 +  MACRO EXPLOREOBS
15227 +
15228 +  SUPPORT:  SASDHD - David Duling
15229 +  PRODUCT:  Enterprise Miner
15230 +
15231 +  DESCRIPTION:
15232 +  Generates maximum and default numbers of observations to
15233 +  download for visualization depending on the record length.
15234 +
15235 +  Values were determined by trial and error using typical
15236 +  Windows workstation configurations.
15237 +
15238 +  Discrete sets of values are returned so that user experience
15239 +  will be consitent with similar sized data sets.
15240 +
15241 +  These macro variables are set:
15242 +  _exploreobs_max -- maximum number of obs downloadable
15243 +  _exploreobs_def -- default number of obs to be downloaded
15244 +  _exploreobs_recl - record length.  Might be useful for reporting.
15245 +
15246 +  Use the _exploreobs_max to set limit the GUI selection of
15247 +  observations for downloading.  The GUI selection for obs
15248 +  could be reduced to "Default" and "Max".
15249 +
15250 +  Parameters
15251 +  data=   libname.memname of input data
15252 +  vars=   subset list of variables.
15253 +          downloading 1 out of 500 really does work like downloading
15254 +          1 out of 1 vars.  Users may select a subset of vars for
15255 +                   visualizations.  Pass in the list as space delimited
15256 +          var names.  If vars is not specified, the record length
15257 +          of the entire data will be used.
15258 +  NBYTES=   maximum number of bytes that shouldn't be exceeded.
15259 +
15260 +  Control
15261 +  Users may control the values by entering these macro variables.
15262 +            EM_EXPLOREOBS_MAX
15263 +            EM_EXPLOREOBS_DEFAULT
15264 +  These values override the computed values.
15265 +
15266 +  Debugging
15267 +  %let _exploreobs_debug=1 ;
15268 +--------------------------------------------------------------------
15269 +  HISTORY: 20APR2004. sasdhd. pushed.
15270 +           18DEC2004. sasdhd. S0280556.
15271 +           07SEP2007. sasdhd. HK1009586
15272 +--------------------------------------------------------------------*/
15273 +
15274 +%macro exploreobs(data=,vars=, nbytes=) ;
15275 +
15276 +   /*--- variable definitions ---*/
15277 +   %global _exploreobs_max _exploreobs_def _exploreobs_recl _exploreobs_debug ;
15278 +   %local xobs xvars xlen vlen xi vname vlist ;
15279 +   %local _exp_source _exp_notes ;
15280 +
15281 +   /*--- USER definitions ---*/
15282 +   %global EM_EXPLOREOBS_MAX EM_EXPLOREOBS_DEFAULT ;
15283 +
15284 +   /*--- variable intializations ---*/
15285 +   %let _exploreobs_max=0 ;
15286 +   %let _exploreobs_def=0 ;
15287 +   %let _exploreobs_recl=0 ;
15288 +   %let xvars= 0 ;
15289 +   %let xlen = 0 ;
15290 +   %let xobs = 0 ;
15291 +
15292 +   /*--- data error checks ---*/
15293 +   %if "&data" eq "" %then %do ;
15294 +            %put NOTE: DATA is not specified. ;
15295 +            %goto term ;
15296 +      %end ;
15297 +
15298 +   %let dsid=%sysfunc(open(&data)) ;
15299 +   %if not &dsid %then %do ;
15300 +            %put NOTE: DATA &data is not available. ;
15301 +            %goto term ;
15302 +      %end ;
15303 +
15304 +   /*--- if a vars list exists generate a subset ---*/
15305 +   %if &vars ne %then %do ;
15306 +         %let dsid=%sysfunc(close(&dsid)) ;
15307 +         %if &_exploreobs_debug ne 1 %then %do ;
15308 +                  %let _exp_source=%sysfunc(getoption(SOURCE)) ;
15309 +            %let _exp_notes =%sysfunc(getoption(NOTES)) ;
15310 +                  options nosource nonotes ;
15311 +         %end ;
15312 +         data _exploreobs_temp_data ;
15313 +         set &data(obs=0) ;
15314 +          keep &vars ;
15315 +         run;
15316 +         %if &_exploreobs_debug ne 1 %then %do ;
15317 +                  options &_exp_source &_exp_notes ;
15318 +         %end ;
15319 +         %let dsid=%sysfunc(open(_exploreobs_temp_data)) ;
15320 +         %if &dsid eq 0 %then %do ;
15321 +                  %put NOTE: Sample is not available.;
15322 +                  %goto term ;
15323 +            %end ;
15324 +      %end ;
15325 +
15326 +   /*--- get var attributes ---*/
15327 +   %let xvars=%sysfunc(attrn(&dsid,nvars)) ;
15328 +   %let xobs= %sysfunc(attrn(&dsid,nobs )) ;
15329 +   %let xlen= %sysfunc(attrn(&dsid,lrecl)) ;
15330 +   %let dsid= %sysfunc(close(&dsid)) ;
15331 +
15332 +   /*--- set default and max obs ---*/
15333 +   %let _exploreobs_recl=%eval(&xlen) ;
15334 +   %if &_exploreobs_recl eq 0 %then %do ;
15335 +             %let _exploreobs_max= 0 ;
15336 +             %let _exploreobs_def= 0 ;
15337 +             %goto term ;
15338 +
15339 +   %end ;
15340 +   %else
15341 +   %if &_exploreobs_recl le 32 %then %do ;
15342 +             %let _exploreobs_max=100000 ;
15343 +             %let _exploreobs_def= 10000 ;
15344 +   %end ;
15345 +   %else
15346 +   %if &_exploreobs_recl le 128 %then %do ;
15347 +             %let _exploreobs_max=60000 ;
15348 +             %let _exploreobs_def= 6000 ;
15349 +   %end ;
15350 +   %else
15351 +   %if &_exploreobs_recl lt 1000 %then %do ;
15352 +             %let _exploreobs_max=20000 ;
15353 +             %let _exploreobs_def= 2000 ;
15354 +   %end ;
15355 +   %else
15356 +   %if &_exploreobs_recl lt 5000 %then %do ;
15357 +             %let _exploreobs_max= 10000 ;
15358 +             %let _exploreobs_def=  1000 ;
15359 +   %end ;
15360 +   %else
15361 +   %if &_exploreobs_recl lt 20000 %then %do ;
15362 +             %let _exploreobs_max= 5000 ;
15363 +             %let _exploreobs_def=  500 ;
15364 +   %end ;
15365 +   %else %do ;
15366 +             %let _exploreobs_max= 1000 ;
15367 +             %let _exploreobs_def=  200 ;
15368 +   %end ;
15369 +
15370 +   /*--- Users options ---*/
15371 +   %if &EM_EXPLOREOBS_MAX ne %then %do ;
15372 +            %let _exploreobs_max= %eval(&EM_EXPLOREOBS_MAX) ;
15373 +   %end;
15374 +   %if &EM_EXPLOREOBS_DEFAULT ne %then %do ;
15375 +            %let _exploreobs_def= %eval(&EM_EXPLOREOBS_DEFAULT) ;
15376 +   %end;
15377 +
15378 +    /*--- S0868273 ---*/
15379 +    %if "&NBYTES" ne "" %then %do;
15380 +       %let nbytes_nrows = %eval(&nbytes/ &_exploreobs_recl);
15381 +       %if &EM_EXPLOREOBS_MAX ne %then %do ;
15382 +           %let _exploreobs_max   = %sysfunc(min(&nbytes_nrows , &EM_EXPLOREOBS_MAX));
15383 +       %end;
15384 +
15385 +       %if &EM_EXPLOREOBS_DEFAULT ne %then %do ;
15386 +          %let nbytes_nrows      = %eval(&nbytes_nrows/10);
15387 +          %let _exploreobs_def   = %sysfunc(min(&nbytes_nrows , &EM_EXPLOREOBS_DEFAULT));
15388 +          %if ^&_exploreobs_def %then
15389 +              %let _exploreobs_def = 1;
15390 +
15391 +       %end;
15392 +    %end;
15393 +
15394 +   /*--- Terminate ---*/
15395 +   %term:
15396 +
15397 +   %put NOTE: EXPLOREOBS &data : vars= &xvars : recl= &_exploreobs_recl : max=&_exploreobs_max : def= &_exploreobs_def ;
15398 +%mend ;
15399 +
15400 +
NOTE: %INCLUDE (level 2) ending.
NOTE: %INCLUDE (level 1) resuming.
NOTE: Fileref X has been deassigned.
NOTE: EXPLOREOBS EMWS2.Ids_DATA : vars= 6 : recl= 48 : max=60000 : def= 6000
PERFORMANCE  DETAILS
*------------------------------------------------------------*
* FirstN/Top sample
*------------------------------------------------------------*
 
NOTE: View EMWS2.IDS_DATA.VIEW used (Total process time):
      real time           0.06 seconds
      cpu time            0.04 seconds
 
NOTE: There were 45 observations read from the data set WQD7005.MILESTONE4_TRAIN.
NOTE: There were 45 observations read from the data set EMWS2.IDS_DATA.
NOTE: The data set EMWS2.GRFEXPL_SAMPLE_DATA has 45 observations and 6 variables.
NOTE: DATA statement used (Total process time):
      real time           0.08 seconds
      cpu time            0.07 seconds
 
 
NOTE: %INCLUDE (level 1) ending.
NOTE: Fileref TEMP has been deassigned.
NOTE: %INCLUDE (level 1) file VARTEMP is file SASHELP.EMUTIL.EM_VARMACRO.SOURCE.
15402 +%macro em_varMacro(name=emMacro, metadata=, where=, key=NAME, nummacro=, maxvar=-1);
15404 +   filename macFile catalog 'work.emutil.macro.source';
15405 +   %let _METAOBS = 0;
15406 +   %let _maxvar = &maxvar;
15407 +   %if "&_maxvar" eq "" %then %let maxvar = -1;
15409 +   %if (%sysfunc(exist(&metadata))<1 and %sysfunc(exist(&metadata, VIEW))<1)
15410 +                   or (&metadata eq ) %then %do;
15411 +       %put * No metadata data set defined;
15412 +       %goto doend;
15413 +   %end;
15415 +   data _null_;
15416 +      length _STRING_ $80;
15417 +      retain _STRING_ '' maxvar 0;
15418 +      set &metadata end=eof;
15419 +      file macFile;
15420 +      %if %nrbquote(&where) ne %then %do;
15421 +          %let whereClause = where (%nrbquote(&where));
15422 +          %unquote(&whereClause);
15423 +      %end;
15424 +      if _N_=1 then do;
15425 +         string = "%"!!"macro &name;";
15426 +         put string;
15427 +      end;
15428 +      maxvar +1;
15429 +      if (length(_STRING_) + length(trim(&key))+ 4 < 80) then do;
15430 +         _STRING_ = trim(_STRING_)!!' '!!trim(&key);
15431 +         if eof
15432 +            %if  %sysevalf(&_maxvar > 0) %then %do;
15433 +                or maxvar >= &maxvar
15434 +            %end;
15435 +            then do;
15436 +            put _STRING_;
15437 +            string = "%"!!"mend &name;";
15438 +            put string;
15439 +            string = strip(put(_N_, best.));
15440 +            call symput('_METAOBS', string);
15441 +            %if (&nummacro ne ) %then %do;
15442 +                put "%" "global &nummacro;";
15443 +                put "%" "let &nummacro = " string ";";
15444 +            %end;
15445 +            stop;
15446 +         end;
15447 +      end;
15448 +      else do;
15449 +         put _STRING_;
15450 +         _string_ = TRIM(&key);
15451 +         if eof
15452 +            %if  %sysevalf(&_maxvar > 0) %then %do;
15453 +              or maxvar >= &maxvar
15454 +           %end;
15455 +            then do;
15456 +            put _STRING_;
15457 +            string = "%"!!"mend &name;";
15458 +            put string;
15459 +        end;
15460 +      end;
15461 +      if eof
15462 +         %if  %sysevalf(&_maxvar > 0) %then %do;
15463 +             or maxvar >= &maxvar
15464 +         %end;
15465 +         then do;
15466 +         string = strip(put(_N_, best.));
15467 +         call symput('_METAOBS', string);
15468 +         %if (&nummacro ne ) %then %do;
15469 +             put "%" "global &nummacro;";
15470 +             put "%" "let &nummacro = " string ";";
15471 +         %end;
15472 +         stop;
15473 +      end;
15474 +   run;
15476 +   %doend:
15477 +   %if ^&_METAOBS %then %do;
15478 +       data _null_;
15479 +          file macFile;
15480 +          put "%" "macro &name;";
15481 +          put "%" "mend &name;";
15482 +          %if (&nummacro ne ) %then %do;
15483 +              put "%" "global &nummacro;";
15484 +              put "%" "let &nummacro = 0;";
15485 +          %end;
15486 +      run;
15487 +   %end;
15488 +   %inc macFile;
15489 +   filename macFile;
15490 +%mend em_varMacro;
NOTE: %INCLUDE (level 1) ending.
NOTE: Fileref VARTEMP has been deassigned.
 
NOTE: There were 6 observations read from the data set EMWS2.GRFEXPL_VARIABLESET.
      WHERE ((ROLE='REJECTED') and (USE='Y')) or (ROLE='FREQ') or ((ROLE not = 'REJECTED') and USE in ('D', 'Y'));
NOTE: The data set WORK.TEMPVARIABLESET has 6 observations and 22 variables.
NOTE: DATA statement used (Total process time):
      real time           0.02 seconds
      cpu time            0.03 seconds
 
 
 
NOTE: The file MACFILE is:
      Catalog Name=WORK.EMUTIL.MACRO.SOURCE,
      Catalog Page Size=4096,
      Number of Catalog Pages=5,
      Created=Sat, May 11, 2019 09:41:56 PM,
      Last Modified=Sat, May 11, 2019 09:41:56 PM,
      Filename=C:\Users\QR\AppData\Local\Temp\SAS Temporary Files\_TD37900_JOHNLAW-PC_\emutil.sas7bcat,
      Release Created=9.0401M3,Host Created=W32_7PRO
 
NOTE: 5 records were written to the file MACFILE.
      The minimum record length was 16.
      The maximum record length was 49.
NOTE: There were 6 observations read from the data set WORK.TEMPVARIABLESET.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
NOTE: %INCLUDE (level 1) file MACFILE is file WORK.EMUTIL.MACRO.SOURCE.
15491 +%macro varSample;
15492 +GASMSIA PETGAS PETGAS_CR PETGAS_CS SIGGAS thedate
15493 +%mend varSample;
15494 +%global numVarSample;
15495 +%let numVarSample = 6 ;
NOTE: %INCLUDE (level 1) ending.
NOTE: Fileref MACFILE has been deassigned.
NOTE: %INCLUDE (level 1) file X is file SASHELP.EMUTIL.EXPLOREOBS.SOURCE.
15496 +/*------------------------------------------------------------------
15497 +  MACRO EXPLOREOBS
15498 +
15499 +  SUPPORT:  SASDHD - David Duling
15500 +  PRODUCT:  Enterprise Miner
15501 +
15502 +  DESCRIPTION:
15503 +  Generates maximum and default numbers of observations to
15504 +  download for visualization depending on the record length.
15505 +
15506 +  Values were determined by trial and error using typical
15507 +  Windows workstation configurations.
15508 +
15509 +  Discrete sets of values are returned so that user experience
15510 +  will be consitent with similar sized data sets.
15511 +
15512 +  These macro variables are set:
15513 +  _exploreobs_max -- maximum number of obs downloadable
15514 +  _exploreobs_def -- default number of obs to be downloaded
15515 +  _exploreobs_recl - record length.  Might be useful for reporting.
15516 +
15517 +  Use the _exploreobs_max to set limit the GUI selection of
15518 +  observations for downloading.  The GUI selection for obs
15519 +  could be reduced to "Default" and "Max".
15520 +
15521 +  Parameters
15522 +  data=   libname.memname of input data
15523 +  vars=   subset list of variables.
15524 +          downloading 1 out of 500 really does work like downloading
15525 +          1 out of 1 vars.  Users may select a subset of vars for
15526 +                   visualizations.  Pass in the list as space delimited
15527 +          var names.  If vars is not specified, the record length
15528 +          of the entire data will be used.
15529 +  NBYTES=   maximum number of bytes that shouldn't be exceeded.
15530 +
15531 +  Control
15532 +  Users may control the values by entering these macro variables.
15533 +            EM_EXPLOREOBS_MAX
15534 +            EM_EXPLOREOBS_DEFAULT
15535 +  These values override the computed values.
15536 +
15537 +  Debugging
15538 +  %let _exploreobs_debug=1 ;
15539 +--------------------------------------------------------------------
15540 +  HISTORY: 20APR2004. sasdhd. pushed.
15541 +           18DEC2004. sasdhd. S0280556.
15542 +           07SEP2007. sasdhd. HK1009586
15543 +--------------------------------------------------------------------*/
15544 +
15545 +%macro exploreobs(data=,vars=, nbytes=) ;
15546 +
15547 +   /*--- variable definitions ---*/
15548 +   %global _exploreobs_max _exploreobs_def _exploreobs_recl _exploreobs_debug ;
15549 +   %local xobs xvars xlen vlen xi vname vlist ;
15550 +   %local _exp_source _exp_notes ;
15551 +
15552 +   /*--- USER definitions ---*/
15553 +   %global EM_EXPLOREOBS_MAX EM_EXPLOREOBS_DEFAULT ;
15554 +
15555 +   /*--- variable intializations ---*/
15556 +   %let _exploreobs_max=0 ;
15557 +   %let _exploreobs_def=0 ;
15558 +   %let _exploreobs_recl=0 ;
15559 +   %let xvars= 0 ;
15560 +   %let xlen = 0 ;
15561 +   %let xobs = 0 ;
15562 +
15563 +   /*--- data error checks ---*/
15564 +   %if "&data" eq "" %then %do ;
15565 +            %put NOTE: DATA is not specified. ;
15566 +            %goto term ;
15567 +      %end ;
15568 +
15569 +   %let dsid=%sysfunc(open(&data)) ;
15570 +   %if not &dsid %then %do ;
15571 +            %put NOTE: DATA &data is not available. ;
15572 +            %goto term ;
15573 +      %end ;
15574 +
15575 +   /*--- if a vars list exists generate a subset ---*/
15576 +   %if &vars ne %then %do ;
15577 +         %let dsid=%sysfunc(close(&dsid)) ;
15578 +         %if &_exploreobs_debug ne 1 %then %do ;
15579 +                  %let _exp_source=%sysfunc(getoption(SOURCE)) ;
15580 +            %let _exp_notes =%sysfunc(getoption(NOTES)) ;
15581 +                  options nosource nonotes ;
15582 +         %end ;
15583 +         data _exploreobs_temp_data ;
15584 +         set &data(obs=0) ;
15585 +          keep &vars ;
15586 +         run;
15587 +         %if &_exploreobs_debug ne 1 %then %do ;
15588 +                  options &_exp_source &_exp_notes ;
15589 +         %end ;
15590 +         %let dsid=%sysfunc(open(_exploreobs_temp_data)) ;
15591 +         %if &dsid eq 0 %then %do ;
15592 +                  %put NOTE: Sample is not available.;
15593 +                  %goto term ;
15594 +            %end ;
15595 +      %end ;
15596 +
15597 +   /*--- get var attributes ---*/
15598 +   %let xvars=%sysfunc(attrn(&dsid,nvars)) ;
15599 +   %let xobs= %sysfunc(attrn(&dsid,nobs )) ;
15600 +   %let xlen= %sysfunc(attrn(&dsid,lrecl)) ;
15601 +   %let dsid= %sysfunc(close(&dsid)) ;
15602 +
15603 +   /*--- set default and max obs ---*/
15604 +   %let _exploreobs_recl=%eval(&xlen) ;
15605 +   %if &_exploreobs_recl eq 0 %then %do ;
15606 +             %let _exploreobs_max= 0 ;
15607 +             %let _exploreobs_def= 0 ;
15608 +             %goto term ;
15609 +
15610 +   %end ;
15611 +   %else
15612 +   %if &_exploreobs_recl le 32 %then %do ;
15613 +             %let _exploreobs_max=100000 ;
15614 +             %let _exploreobs_def= 10000 ;
15615 +   %end ;
15616 +   %else
15617 +   %if &_exploreobs_recl le 128 %then %do ;
15618 +             %let _exploreobs_max=60000 ;
15619 +             %let _exploreobs_def= 6000 ;
15620 +   %end ;
15621 +   %else
15622 +   %if &_exploreobs_recl lt 1000 %then %do ;
15623 +             %let _exploreobs_max=20000 ;
15624 +             %let _exploreobs_def= 2000 ;
15625 +   %end ;
15626 +   %else
15627 +   %if &_exploreobs_recl lt 5000 %then %do ;
15628 +             %let _exploreobs_max= 10000 ;
15629 +             %let _exploreobs_def=  1000 ;
15630 +   %end ;
15631 +   %else
15632 +   %if &_exploreobs_recl lt 20000 %then %do ;
15633 +             %let _exploreobs_max= 5000 ;
15634 +             %let _exploreobs_def=  500 ;
15635 +   %end ;
15636 +   %else %do ;
15637 +             %let _exploreobs_max= 1000 ;
15638 +             %let _exploreobs_def=  200 ;
15639 +   %end ;
15640 +
15641 +   /*--- Users options ---*/
15642 +   %if &EM_EXPLOREOBS_MAX ne %then %do ;
15643 +            %let _exploreobs_max= %eval(&EM_EXPLOREOBS_MAX) ;
15644 +   %end;
15645 +   %if &EM_EXPLOREOBS_DEFAULT ne %then %do ;
15646 +            %let _exploreobs_def= %eval(&EM_EXPLOREOBS_DEFAULT) ;
15647 +   %end;
15648 +
15649 +    /*--- S0868273 ---*/
15650 +    %if "&NBYTES" ne "" %then %do;
15651 +       %let nbytes_nrows = %eval(&nbytes/ &_exploreobs_recl);
15652 +       %if &EM_EXPLOREOBS_MAX ne %then %do ;
15653 +           %let _exploreobs_max   = %sysfunc(min(&nbytes_nrows , &EM_EXPLOREOBS_MAX));
15654 +       %end;
15655 +
15656 +       %if &EM_EXPLOREOBS_DEFAULT ne %then %do ;
15657 +          %let nbytes_nrows      = %eval(&nbytes_nrows/10);
15658 +          %let _exploreobs_def   = %sysfunc(min(&nbytes_nrows , &EM_EXPLOREOBS_DEFAULT));
15659 +          %if ^&_exploreobs_def %then
15660 +              %let _exploreobs_def = 1;
15661 +
15662 +       %end;
15663 +    %end;
15664 +
15665 +   /*--- Terminate ---*/
15666 +   %term:
15667 +
15668 +   %put NOTE: EXPLOREOBS &data : vars= &xvars : recl= &_exploreobs_recl : max=&_exploreobs_max : def= &_exploreobs_def ;
15669 +%mend ;
15670 +
15671 +
NOTE: %INCLUDE (level 1) ending.
NOTE: Fileref X has been deassigned.
NOTE: EXPLOREOBS EMWS2.Ids_DATA : vars= 6 : recl= 48 : max=60000 : def= 6000
PERFORMANCE  DETAILS
*------------------------------------------------------------*
* FirstN/Top sample
*------------------------------------------------------------*
 
NOTE: View EMWS2.IDS_DATA.VIEW used (Total process time):
      real time           0.04 seconds
      cpu time            0.04 seconds
 
NOTE: There were 45 observations read from the data set WQD7005.MILESTONE4_TRAIN.
NOTE: There were 45 observations read from the data set EMWS2.IDS_DATA.
NOTE: The data set EMWS2.GRFEXPL_SAMPLE_DATA has 45 observations and 6 variables.
NOTE: DATA statement used (Total process time):
      real time           0.05 seconds
      cpu time            0.06 seconds
 
 
15672  *------------------------------------------------------------*;
15673  * End TRAIN: GrfExpl;
15674  *------------------------------------------------------------*;
15675
 
15676  *------------------------------------------------------------*;
15677  * Close any missing semi colons;
15678  *------------------------------------------------------------*;
15679  ;
15680  ;
15681  ;
15682  ;
15683  quit;
15684  *------------------------------------------------------------*;
15685  * Close any unbalanced quotes;
15686  *------------------------------------------------------------*;
15687  /*; *"; *'; */
15688  ;
15689  run;
15690  quit;
15691  /* Reset EM Options */
15692  options formchar="|----|+|---+=|-/\<>*";
15693  options nocenter ls=256 ps=10000;
15694  goptions reset=all device=GIF NODISPLAY;
 
*------------------------------------------------------------*
* Score Log
Date:                May 11, 2019
Time:                21:41:58
*------------------------------------------------------------*
15796  %let EMEXCEPTIONSTRING=;
15797  *------------------------------------------------------------*;
15798  * SCORE: GrfExpl;
15799  *------------------------------------------------------------*;
15800  %let EM_ACTION = SCORE;
15801  %let syscc = 0;
15802  %macro main;
15803     filename temp catalog 'sashelp.emexpl.graphexplore_macros.source';
15804     %include temp;
15805     filename temp;
15806
15807     %SetProperties;
15808
15809     %if %upcase(&EM_ACTION) = CREATE %then %do;
15810
15811         filename temp catalog 'sashelp.emexpl.graphexplore_create.source';
15812         %include temp;
15813         filename temp;
15814         %create;
15815     %end;
15816     %else
15817     %if %upcase(&EM_ACTION) = TRAIN %then %do;
15818
15819         filename temp catalog 'sashelp.emexpl.graphexplore_train.source';
15820         %include temp;
15821         filename temp;
15822         %train;
15823
15824     %end;
15825     %else
15826     %if %upcase(&EM_ACTION) = REPORT %then %do;
15827
15828         filename temp catalog 'sashelp.emexpl.graphexplore_report.source';
15829         %include temp;
15830         filename temp;
15831
15832         %report;
15833     %end;
15834
15835  %mend main;
15836
15837  %main;
NOTE: %INCLUDE (level 1) file TEMP is file SASHELP.EMEXPL.GRAPHEXPLORE_MACROS.SOURCE.
15838 +%macro SetProperties;
15839 +   %em_checkmacro(name=EM_PROPERTY_INTERVALBYTARGET,      global=Y, value=Y);
15840 +   %em_checkmacro(name=EM_PROPERTY_CLASSBYTARGET,         global=Y, value=Y);
15841 +   %em_checkmacro(name=EM_PROPERTY_DATASOURCE,            global=Y, value=SAMPLE);
15842 +   %em_checkmacro(name=EM_PROPERTY_EMSAMPLEMETHOD,        global=Y, value=FIRSTN);
15843 +   %em_checkmacro(name=EM_PROPERTY_EMSAMPLESIZE,          global=Y, value=DEFAULT);
15844 +   %em_checkmacro(name=EM_PROPERTY_EMRANDOMSEED,          global=Y, value=12345);
15845 +
15846 +%mend SetProperties;
NOTE: %INCLUDE (level 1) ending.
NOTE: Fileref TEMP has been deassigned.
15847  *------------------------------------------------------------*;
15848  * End SCORE: GrfExpl;
15849  *------------------------------------------------------------*;
15850
 
15851  *------------------------------------------------------------*;
15852  * GrfExpl: Scoring DATA data;
15853  *------------------------------------------------------------*;
15854  data EMWS2.GrfExpl_TRAIN
15855  / view=EMWS2.GrfExpl_TRAIN
15856  ;
15857  set EMWS2.Ids_DATA
15858  ;
15859  run;
 
NOTE: DATA STEP view saved on file EMWS2.GRFEXPL_TRAIN.
NOTE: A stored DATA STEP view cannot run under a different operating system.
NOTE: View EMWS2.IDS_DATA.VIEW used (Total process time):
      real time           0.04 seconds
      cpu time            0.04 seconds
 
NOTE: DATA statement used (Total process time):
      real time           0.06 seconds
      cpu time            0.06 seconds
 
 
15860  quit;
 
15862  *------------------------------------------------------------*;
15863  * GrfExpl: Computing metadata for TRAIN data;
15864  *------------------------------------------------------------*;
 
NOTE: View EMWS2.GRFEXPL_TRAIN.VIEW used (Total process time):
      real time           0.07 seconds
      cpu time            0.06 seconds
 
NOTE: View EMWS2.GRFEXPL_TRAIN.VIEW used (Total process time):
      real time           0.07 seconds
      cpu time            0.06 seconds
 
*------------------------------------------------------------*
* Report Log
Date:                May 11, 2019
Time:                21:41:59
*------------------------------------------------------------*
16225  %let EMEXCEPTIONSTRING=;
16226  *------------------------------------------------------------*;
16227  * REPORT: GrfExpl;
16228  *------------------------------------------------------------*;
16229  %let EM_ACTION = REPORT;
16230  %let syscc = 0;
16231  %macro main;
16232     filename temp catalog 'sashelp.emexpl.graphexplore_macros.source';
16233     %include temp;
16234     filename temp;
16235
16236     %SetProperties;
16237
16238     %if %upcase(&EM_ACTION) = CREATE %then %do;
16239
16240         filename temp catalog 'sashelp.emexpl.graphexplore_create.source';
16241         %include temp;
16242         filename temp;
16243         %create;
16244     %end;
16245     %else
16246     %if %upcase(&EM_ACTION) = TRAIN %then %do;
16247
16248         filename temp catalog 'sashelp.emexpl.graphexplore_train.source';
16249         %include temp;
16250         filename temp;
16251         %train;
16252
16253     %end;
16254     %else
16255     %if %upcase(&EM_ACTION) = REPORT %then %do;
16256
16257         filename temp catalog 'sashelp.emexpl.graphexplore_report.source';
16258         %include temp;
16259         filename temp;
16260
16261         %report;
16262     %end;
16263
16264  %mend main;
16265
16266  %main;
NOTE: %INCLUDE (level 1) file TEMP is file SASHELP.EMEXPL.GRAPHEXPLORE_MACROS.SOURCE.
16267 +%macro SetProperties;
16268 +   %em_checkmacro(name=EM_PROPERTY_INTERVALBYTARGET,      global=Y, value=Y);
16269 +   %em_checkmacro(name=EM_PROPERTY_CLASSBYTARGET,         global=Y, value=Y);
16270 +   %em_checkmacro(name=EM_PROPERTY_DATASOURCE,            global=Y, value=SAMPLE);
16271 +   %em_checkmacro(name=EM_PROPERTY_EMSAMPLEMETHOD,        global=Y, value=FIRSTN);
16272 +   %em_checkmacro(name=EM_PROPERTY_EMSAMPLESIZE,          global=Y, value=DEFAULT);
16273 +   %em_checkmacro(name=EM_PROPERTY_EMRANDOMSEED,          global=Y, value=12345);
16274 +
16275 +%mend SetProperties;
NOTE: %INCLUDE (level 1) ending.
NOTE: Fileref TEMP has been deassigned.
NOTE: %INCLUDE (level 1) file TEMP is file SASHELP.EMEXPL.GRAPHEXPLORE_REPORT.SOURCE.
16276 +%macro report;
16277 +
16278 +   %let sourceKey = em_import_data;
16279 +    %if "&sourceKey" eq "" %then
16280 +        %let sourceKey = em_import_transaction;
16281 +    %if "&sourceKey" eq "" %then
16282 +        %let sourceKey = em_import_document;
16283 +    %if "&sourceKey" eq "" %then
16284 +        %let sourceKey = em_import_validate;
16285 +    %if "&sourceKey" eq "" %then
16286 +        %let sourceKey = em_import_test;
16287 +    %if "&sourceKey" eq "" %then
16288 +        %let sourceKey = em_import_score;
16289 +
16290 +   %if "&EM_PROPERTY_DATASOURCE" = "SAMPLE" %then
16291 +      %let sourceKey =SAMPLE_DATA;
16292 +
16293 +    %em_report(Key=&sourceKey, viewType=DATA, Block=Data, Description=Sample, Autodisplay=Y, localize=Y );
16294 +
16295 +   %if &EM_NUM_TARGET %then %do;
16296 +       %if &EM_NUM_INTERVAL_TARGET %then %do;
16297 +           %do i=1 %to &EM_NUM_INTERVAL_TARGET;
16298 +               %let targetName = %scan(%EM_INTERVAL_TARGET, &i);
16299 +               %if "&EM_PROPERTY_TARGET" = "Y" %then %do;
16300 +                   %em_report(Key=&sourceKey, viewType=HISTOGRAM, X=&targetName, freq=%EM_FREQ, block=Target, AutoDisplay=Y, Description=&targetName);
16301 +               %end;
16302 +
16303 +               %if "&EM_PROPERTY_GROUPBYTARGET" = "Y" and &EM_NUM_SEGMENT %then %do;
16304 +                   %do j=1 %to &EM_NUM_SEGMENT;
16305 +                       %let groupName = %scan(%em_segment, &j);
16306 +                       %em_report(Key=&sourceKey, viewType=BASEBOX, Y=&targetName, X=&groupname, freq=%EM_FREQ, Block=GroupPlots, Description=%nrbquote(&targetName x &groupName));
16307 +                   %end;
16308 +               %end;
16309 +           %end;
16310 +       %end;
16311 +
16312 +       %let numClassTarget = %eval(&EM_NUM_BINARY_TARGET + &EM_NUM_NOMINAL_TARGET + &EM_NUM_ORDINAL_TARGET );
16313 +       %if &numClassTarget %then %do;
16314 +           %do i=1 %to &numClassTarget;
16315 +               %let targetName = %scan(%EM_BINARY_TARGET %EM_NOMINAL_TARGET %EM_ORDINAL_TARGET, &i);
16316 +               %if "&EM_PROPERTY_TARGET" = "Y" %then %do;
16317 +                   %em_report(Key=&sourceKey, viewType=BAR, X=&targetName, freq=%EM_FREQ, block=Target, AutoDisplay=Y, Description=&targetName);
16318 +               %end;
16319 +
16320 +               %if "&EM_PROPERTY_GROUPBYTARGET" = "Y" and &EM_NUM_SEGMENT %then %do;
16321 +                   %do j=1 %to &EM_NUM_SEGMENT;
16322 +                       %let groupName = %scan(%em_segment, &j);
16323 +                       %em_report(Key=&sourceKey, viewType=BAR, X=&groupName, group=&targetname, freq=%EM_FREQ, Block=GroupPlots, Description=%nrbquote(&targetName x &groupName));
16324 +                   %end;
16325 +               %end;
16326 +
16327 +           %end;
16328 +       %end;
16329 +
16330 +   %end;
16331 +
16332 +%mend report;
NOTE: %INCLUDE (level 1) ending.
NOTE: Fileref TEMP has been deassigned.
 
NOTE: The data set WORK.EM_USER_REPORT has 132 observations and 4 variables.
NOTE: DATA statement used (Total process time):
      real time           0.04 seconds
      cpu time            0.03 seconds
 
 
16333  *------------------------------------------------------------*;
16334  * End REPORT: GrfExpl;
16335  *------------------------------------------------------------*;
16336
 
16337  /* Reset EM Options */
16338  options formchar="|----|+|---+=|-/\<>*";
16339  options nocenter ls=256 ps=10000;
16340  goptions reset=all device=GIF NODISPLAY;
 
16341  proc sort data=WORK.EM_USER_REPORT;
16342  by ID VIEW;
16343  run;
 
NOTE: There were 132 observations read from the data set WORK.EM_USER_REPORT.
NOTE: The data set WORK.EM_USER_REPORT has 132 observations and 4 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
 
 
